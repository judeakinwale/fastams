"use strict";(self.webpackChunkamsweb=self.webpackChunkamsweb||[]).push([[308],{8613:function(e,t,n){n.d(t,{b:function(){return o}});var r=n(5043),a=n(3233),i=n(184);function o(e){var t=e.formData,n=e.handleChange,o=e.validationHandler,c=e.errors;return(0,i.jsx)(a.n,{title:"Enter details",children:(0,i.jsx)(r.II,{name:"email",label:"Email Address",value:t.email,onChange:n,type:"email",validationHandler:o,error:c.email,required:!0,size:"large"})})}},8319:function(e,t,n){n.d(t,{Gv:function(){return x},r$:function(){return k},vU:function(){return y},yN:function(){return b}});var r=n(4165),a=n(5861),i=n(6403),o=n(3418),c=n(2917),s=n(7689),u=n(5985),l=n(2805),d=n(6414),f=n(347),m=n(749);function p(){return(p=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.b)({url:"/attendance/sign-in?email=".concat(t.email,"&long=").concat(t.long,"&lat=").concat(t.lat),method:"POST",data:{file:t.file},headers:{"Content-Type":"multipart/form-data"}});case 2:return n=e.sent,e.abrupt("return",null===n||void 0===n?void 0:n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(){return(h=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,l.b)({url:"/user/".concat(t.id,"/image"),method:"PATCH",data:{file:t.file},headers:{"Content-Type":"multipart/form-data"}});case 3:if(!(n=e.sent)||200!==n.status){e.next=11;break}return e.next=7,(0,l.b)({url:"/attendance/sign-in?email=".concat(t.email,"&long=").concat(t.long,"&lat=").concat(t.lat),method:"POST",data:{file:t.file},headers:{"Content-Type":"multipart/form-data"}});case 7:return a=e.sent,e.abrupt("return",null===a||void 0===a?void 0:a.data);case 11:return console.error("First API call failed"),e.abrupt("return",{success:!1,error:"An error Occured, Please try again"});case 13:e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(0),console.error("Error:",e.t0.message),e.t0;case 19:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)}function v(){return(v=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.b)({url:"/user/email/".concat(t),method:"GET",headers:{"Content-Type":"application/json"}});case 2:return a=e.sent,e.abrupt("return",null===a||void 0===a||null===(n=a.data)||void 0===n?void 0:n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(){return(g=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.b)({url:"/attendance/sign-out?email=".concat(t.email,"&long=").concat(t.long,"&lat=").concat(t.lat),method:"PATCH",data:{file:t.file},headers:{"Content-Type":"multipart/form-data"}});case 2:return n=e.sent,e.abrupt("return",null===n||void 0===n?void 0:n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(){var e=(0,i.NL)(),t=(0,s.s0)(),n=(0,o.D)({mutationFn:function(e){return function(e){return p.apply(this,arguments)}(e)},onSuccess:function(n){u.Am.success("Clock in successfull",m.HK),e.invalidateQueries([d.a.clockIn]),setTimeout((function(){t(f.Ot.HOME)}),3e3)},onError:function(e){(0,m.sD)(e,m.HK)}});return{mutate:n.mutate,isError:n.isError,error:n.error,isSuccess:n.isSuccess,reset:n.reset}}function b(){var e=(0,i.NL)(),t=(0,s.s0)(),n=(0,o.D)({mutationFn:function(e){return function(e){return h.apply(this,arguments)}(e)},onSuccess:function(n){u.Am.success("Clock in successfull",m.HK),e.invalidateQueries([d.a.clockIn]),setTimeout((function(){t(f.Ot.HOME)}),3e3)},onError:function(e){(0,m.sD)(e,m.HK)}});return{mutate:n.mutate,isError:n.isError,error:n.error,isSuccess:n.isSuccess,reset:n.reset}}function k(){var e=(0,i.NL)(),t=(0,s.s0)(),n=(0,o.D)({mutationFn:function(e){return function(e){return g.apply(this,arguments)}(e)},onSuccess:function(n){u.Am.success("Clock Out successfull",m.HK),e.invalidateQueries([d.a.clockIn]),setTimeout((function(){t(f.Ot.HOME)}),3e3)},onError:function(e){(0,m.sD)(e,m.HK)}});return{mutate:n.mutate,isError:n.isError,error:n.error,isSuccess:n.isSuccess,reset:n.reset}}function y(e){var t=(0,c.a)({queryKey:[d.a.user,e],queryFn:function(){return function(e){return v.apply(this,arguments)}(e)},onError:function(e){}}),n=t.data;return void 0===n?[]:n}},5308:function(e,t,n){n.r(t);var r=n(4942),a=n(1413),i=n(9439),o=n(2791),c=n(5043),s=n(3722),u=n(8319),l=n(5317),d=n(8613),f=n(6800),m=n(749),p=n(184);t.default=function(){var e=(0,o.useState)({}),t=(0,i.Z)(e,2),n=t[0],h=t[1],v=(0,o.useState)(null),g=(0,i.Z)(v,2),x=g[0],b=g[1],k=(0,o.useState)({}),y=(0,i.Z)(k,2),Z=y[0],j=y[1],S=(0,o.useState)(!1),C=(0,i.Z)(S,2),w=C[0],E=C[1],T=(0,o.useState)(!1),F=(0,i.Z)(T,2),H=F[0],P=F[1],A=(0,o.useRef)(null),D=(0,u.Gv)(),N=D.mutate,I=D.isSuccess,O=D.reset,z=(0,u.yN)(),K=z.mutate,L=(z.isSuccess,z.reset,(0,s.B)()),R=(0,u.vU)(n.email);console.log(R,"userInfo"),(0,o.useEffect)((function(){navigator.geolocation?navigator.geolocation.getCurrentPosition((function(e){h((0,a.Z)((0,a.Z)({},n),{},{long:e.coords.longitude.toString(),lat:e.coords.latitude.toString()}))}),(function(){j((0,a.Z)((0,a.Z)({},Z),{},{location:"Unable to retrieve your location"}))})):j((0,a.Z)((0,a.Z)({},Z),{},{location:"Geolocation is not supported by your browser"}))}),[]);var q=(0,o.useCallback)((function(){var e=A.current.getScreenshot();e?(b(e),h((0,a.Z)((0,a.Z)({},n),{},{file:(0,m.v9)(e,"image")})),E(!1),(0,m.Cq)("Picture captured!")):(0,m.ll)("Please wait for camera to load before clicking on capture!")}),[A,n]),G=(0,f.h)([(0,p.jsx)(d.b,{formData:n,errors:Z,validationHandler:function(e,t){j((0,a.Z)((0,a.Z)({},Z),{},(0,r.Z)({},e,t)))},handleChange:function(e,t){h((0,a.Z)((0,a.Z)({},n),{},(0,r.Z)({},e,t)))}}),(0,p.jsx)(l.s,{webcamRef:A,isLoading:L,capture:q,cameraActive:w,handleCameraClick:function(e){E(!0)},picture:x,formData:n,first:H,data:R})]),U=G.steps,_=G.currentStepIndex,M=G.step,Q=G.isFirstStep,B=G.isLastStep,$=G.back,J=G.next;return I&&O(),(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("h1",{children:"Clock In"}),(0,p.jsxs)(c.cw,{onSubmit:function(){if(!B)return null!==(null===R||void 0===R?void 0:R.face_encoding)&&void 0!==(null===R||void 0===R?void 0:R.face_encoding)||(h((0,a.Z)((0,a.Z)({},n),{},{id:R.id})),P(!0)),J();n.file?H?K(n):N(n):(0,m.ll)("No picture found.\n\t\t\t\tPlease click on 'Take Picture' to attach your picture to the form")},children:[(0,p.jsxs)("div",{style:{position:"absolute",top:".5rem",right:".5rem"},children:[_+1," / ",U.length]}),M,(0,p.jsxs)("div",{style:{marginTop:"1rem",display:"flex",flexDirection:"column",gap:".5rem"},children:[(0,p.jsx)(c.zx,{title:B?"Finish":"Next",size:"large",type:"submit",className:L?"btn-disabled btnPurple":"btnPurple",loading:1===L,disabled:1===L}),!Q&&(0,p.jsx)(c.zx,{title:"back",size:"large",onClick:$,type:"button",className:L?"btn-disabled":"btnRedTxt"})]})]})]})}},3233:function(e,t,n){n.d(t,{n:function(){return a}});var r=n(184);function a(e){var t=e.title,n=e.children;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{style:{textAlign:"left",margin:0,marginBottom:"2rem"},children:t}),(0,r.jsx)(r.Fragment,{children:n})]})}},5317:function(e,t,n){n.d(t,{s:function(){return s}});var r=n(5043),a=n(97),i=n.n(a),o=n(3233),c=n(184);function s(e){var t,n=e.webcamRef,a=e.capture,s=e.cameraActive,u=e.handleCameraClick,l=e.picture,d=e.formData,f=e.first,m=e.data;return s&&(t=(0,c.jsxs)(c.Fragment,{children:[f&&(0,c.jsxs)("div",{children:[(0,c.jsxs)("h3",{children:["Hi ",null===m||void 0===m?void 0:m.first_name]}),(0,c.jsx)("p",{children:"Please take a picture to setup your Face Recognition for the first time"})]}),(0,c.jsx)("div",{className:"webcam",children:(0,c.jsx)(i(),{audio:!1,ref:n,screenshotFormat:"image/jpeg"})}),(0,c.jsx)(r.zx,{title:"capture",type:"button",style:{background:"black"},onClick:a})]})),!s&&l&&(t=(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"webcam",children:(0,c.jsx)("img",{src:l,alt:d.first_name})}),(0,c.jsx)(r.zx,{style:{background:"black"},title:"retake picture",type:"button",onClick:u})]})),s||l||(t=(0,c.jsx)(r.zx,{style:{background:"#3c7d5c"},title:"take picture",type:"button",onClick:u})),(0,c.jsx)(o.n,{title:"Picture Upload",children:t})}},6800:function(e,t,n){n.d(t,{h:function(){return i}});var r=n(9439),a=n(2791);function i(e){var t=(0,a.useState)(0),n=(0,r.Z)(t,2),i=n[0],o=n[1];return{currentStepIndex:i,step:e[i],steps:e,isFirstStep:0===i,isLastStep:i===e.length-1,goTo:function(e){o(e)},next:function(){o((function(t){return t>=e.length-1?t:t+1}))},back:function(){o((function(e){return e<=0?e:e-1}))}}}}}]);
//# sourceMappingURL=308.433394fe.chunk.js.map