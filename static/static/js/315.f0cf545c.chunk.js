"use strict";(self.webpackChunkamsweb=self.webpackChunkamsweb||[]).push([[315],{8613:function(t,e,n){n.d(e,{b:function(){return c}});var r=n(5043),a=n(3233),i=n(184);function c(t){var e=t.formData,n=t.handleChange,c=t.validationHandler,o=t.errors;return(0,i.jsx)(a.n,{title:"Enter details",children:(0,i.jsx)(r.II,{name:"email",label:"Email Address",value:e.email,onChange:n,type:"email",validationHandler:c,error:o.email,required:!0,size:"large"})})}},8319:function(t,e,n){n.d(e,{Gv:function(){return x},r$:function(){return k},vU:function(){return y},yN:function(){return b}});var r=n(4165),a=n(5861),i=n(6403),c=n(3418),o=n(2917),s=n(7689),u=n(5985),l=n(2805),d=n(6414),f=n(347),m=n(749);function p(){return(p=(0,a.Z)((0,r.Z)().mark((function t(e){var n;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,l.b)({url:"/attendance/sign-in?email=".concat(e.email,"&long=").concat(e.long,"&lat=").concat(e.lat),method:"POST",data:{file:e.file},headers:{"Content-Type":"multipart/form-data"}});case 2:return n=t.sent,t.abrupt("return",null===n||void 0===n?void 0:n.data);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function h(){return(h=(0,a.Z)((0,r.Z)().mark((function t(e){var n,a;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,l.b)({url:"/user/".concat(e.id,"/image"),method:"PATCH",data:{file:e.file},headers:{"Content-Type":"multipart/form-data"}});case 3:if(!(n=t.sent)||200!==n.status){t.next=11;break}return t.next=7,(0,l.b)({url:"/attendance/sign-in?email=".concat(e.email,"&long=").concat(e.long,"&lat=").concat(e.lat),method:"POST",data:{file:e.file},headers:{"Content-Type":"multipart/form-data"}});case 7:return a=t.sent,t.abrupt("return",null===a||void 0===a?void 0:a.data);case 11:return console.error("First API call failed"),t.abrupt("return",{success:!1,error:"An error Occured, Please try again"});case 13:t.next=19;break;case 15:throw t.prev=15,t.t0=t.catch(0),console.error("Error:",t.t0.message),t.t0;case 19:case"end":return t.stop()}}),t,null,[[0,15]])})))).apply(this,arguments)}function v(){return(v=(0,a.Z)((0,r.Z)().mark((function t(e){var n,a;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,l.b)({url:"/user/email/".concat(e),method:"GET",headers:{"Content-Type":"application/json"}});case 2:return a=t.sent,t.abrupt("return",null===a||void 0===a||null===(n=a.data)||void 0===n?void 0:n.data);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function g(){return(g=(0,a.Z)((0,r.Z)().mark((function t(e){var n;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,l.b)({url:"/attendance/sign-out?email=".concat(e.email,"&long=").concat(e.long,"&lat=").concat(e.lat),method:"PATCH",data:{file:e.file},headers:{"Content-Type":"multipart/form-data"}});case 2:return n=t.sent,t.abrupt("return",null===n||void 0===n?void 0:n.data);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function x(){var t=(0,i.NL)(),e=(0,s.s0)(),n=(0,c.D)({mutationFn:function(t){return function(t){return p.apply(this,arguments)}(t)},onSuccess:function(n){u.Am.success("Clock in successfull",m.HK),t.invalidateQueries([d.a.clockIn]),setTimeout((function(){e(f.Ot.HOME)}),3e3)},onError:function(t){(0,m.sD)(t,m.HK)}});return{mutate:n.mutate,isError:n.isError,error:n.error,isSuccess:n.isSuccess,reset:n.reset}}function b(){var t=(0,i.NL)(),e=(0,s.s0)(),n=(0,c.D)({mutationFn:function(t){return function(t){return h.apply(this,arguments)}(t)},onSuccess:function(n){u.Am.success("Clock in successfull",m.HK),t.invalidateQueries([d.a.clockIn]),setTimeout((function(){e(f.Ot.HOME)}),3e3)},onError:function(t){(0,m.sD)(t,m.HK)}});return{mutate:n.mutate,isError:n.isError,error:n.error,isSuccess:n.isSuccess,reset:n.reset}}function k(){var t=(0,i.NL)(),e=(0,s.s0)(),n=(0,c.D)({mutationFn:function(t){return function(t){return g.apply(this,arguments)}(t)},onSuccess:function(n){u.Am.success("Clock Out successfull",m.HK),t.invalidateQueries([d.a.clockIn]),setTimeout((function(){e(f.Ot.HOME)}),3e3)},onError:function(t){(0,m.sD)(t,m.HK)}});return{mutate:n.mutate,isError:n.isError,error:n.error,isSuccess:n.isSuccess,reset:n.reset}}function y(t){var e=(0,o.a)({queryKey:[d.a.user,t],queryFn:function(){return function(t){return v.apply(this,arguments)}(t)},onError:function(t){}}),n=e.data;return void 0===n?[]:n}},6315:function(t,e,n){n.r(e);var r=n(4942),a=n(1413),i=n(9439),c=n(2791),o=n(5043),s=n(3722),u=n(8319),l=n(749),d=n(6800),f=n(8613),m=n(5317),p=n(184);e.default=function(){var t=(0,c.useState)({}),e=(0,i.Z)(t,2),n=e[0],h=e[1],v=(0,c.useState)(null),g=(0,i.Z)(v,2),x=g[0],b=g[1],k=(0,c.useState)({}),y=(0,i.Z)(k,2),Z=y[0],j=y[1],C=(0,c.useState)(!1),S=(0,i.Z)(C,2),w=S[0],E=S[1],T=(0,c.useRef)(null),F=(0,u.r$)(),H=F.mutate,P=F.isSuccess,A=F.reset,D=(0,s.B)();(0,c.useEffect)((function(){navigator.geolocation?navigator.geolocation.getCurrentPosition((function(t){h((0,a.Z)((0,a.Z)({},n),{},{long:t.coords.longitude.toString(),lat:t.coords.latitude.toString()}))}),(function(){j((0,a.Z)((0,a.Z)({},Z),{},{location:"Unable to retrieve your location"}))})):j((0,a.Z)((0,a.Z)({},Z),{},{location:"Geolocation is not supported by your browser"}))}),[]);var O=(0,c.useCallback)((function(){var t=T.current.getScreenshot();t?(b(t),h((0,a.Z)((0,a.Z)({},n),{},{file:(0,l.v9)(t,"image")})),E(!1),(0,l.Cq)("Picture captured!")):(0,l.ll)("Please wait for camera to load before clicking on capture!")}),[T,n]),N=(0,d.h)([(0,p.jsx)(f.b,{formData:n,errors:Z,validationHandler:function(t,e){j((0,a.Z)((0,a.Z)({},Z),{},(0,r.Z)({},t,e)))},handleChange:function(t,e){h((0,a.Z)((0,a.Z)({},n),{},(0,r.Z)({},t,e)))}}),(0,p.jsx)(m.s,{webcamRef:T,isLoading:D,capture:O,cameraActive:w,handleCameraClick:function(t){E(!0)},picture:x,formData:n})]),z=N.steps,I=N.currentStepIndex,K=N.step,L=N.isFirstStep,R=N.isLastStep,q=N.back,G=N.next;return P&&A(),(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("h1",{children:"Clock Out"}),(0,p.jsxs)(o.cw,{onSubmit:function(){if(!R)return G();n.file?H(n):(0,l.ll)("No picture found.\n\t\t\t\tPlease click on 'Take Picture' to attach your picture to the form")},children:[(0,p.jsxs)("div",{style:{position:"absolute",top:".5rem",right:".5rem"},children:[I+1," / ",z.length]}),K,(0,p.jsxs)("div",{style:{marginTop:"1rem",display:"flex",flexDirection:"column",gap:".5rem"},children:[(0,p.jsx)(o.zx,{title:R?"Finish":"Next",size:"large",type:"submit",className:D?"btn-disabled":"",loading:1===D,disabled:1===D}),!L&&(0,p.jsx)(o.zx,{title:"back",size:"large",onClick:q,type:"button",className:D?"btn-disabled":"btnRedTxt"})]})]})]})}},3233:function(t,e,n){n.d(e,{n:function(){return a}});var r=n(184);function a(t){var e=t.title,n=t.children;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{style:{textAlign:"left",margin:0,marginBottom:"2rem"},children:e}),(0,r.jsx)(r.Fragment,{children:n})]})}},5317:function(t,e,n){n.d(e,{s:function(){return s}});var r=n(5043),a=n(97),i=n.n(a),c=n(3233),o=n(184);function s(t){var e,n=t.webcamRef,a=t.capture,s=t.cameraActive,u=t.handleCameraClick,l=t.picture,d=t.formData,f=t.first,m=t.data;return s&&(e=(0,o.jsxs)(o.Fragment,{children:[f&&(0,o.jsxs)("div",{children:[(0,o.jsxs)("h3",{children:["Hi ",null===m||void 0===m?void 0:m.first_name]}),(0,o.jsx)("p",{children:"Please take a picture to setup your Face Recognition for the first time"})]}),(0,o.jsx)("div",{className:"webcam",children:(0,o.jsx)(i(),{audio:!1,ref:n,screenshotFormat:"image/jpeg"})}),(0,o.jsx)(r.zx,{title:"capture",type:"button",style:{background:"black"},onClick:a})]})),!s&&l&&(e=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"webcam",children:(0,o.jsx)("img",{src:l,alt:d.first_name})}),(0,o.jsx)(r.zx,{style:{background:"black"},title:"retake picture",type:"button",onClick:u})]})),s||l||(e=(0,o.jsx)(r.zx,{style:{background:"#3c7d5c"},title:"take picture",type:"button",onClick:u})),(0,o.jsx)(c.n,{title:"Picture Upload",children:e})}},6800:function(t,e,n){n.d(e,{h:function(){return i}});var r=n(9439),a=n(2791);function i(t){var e=(0,a.useState)(0),n=(0,r.Z)(e,2),i=n[0],c=n[1];return{currentStepIndex:i,step:t[i],steps:t,isFirstStep:0===i,isLastStep:i===t.length-1,goTo:function(t){c(t)},next:function(){c((function(e){return e>=t.length-1?e:e+1}))},back:function(){c((function(t){return t<=0?t:t-1}))}}}}}]);
//# sourceMappingURL=315.f0cf545c.chunk.js.map